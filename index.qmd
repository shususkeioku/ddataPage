---
title: ""
filters:
  - shinylive
---

```{shinylive-r}
#| standalone: true
#| viewerHeight: 600

library(tidyverse)
library(shiny)
library(leaflet)
library(geosphere)
library(ggplot2)
library(maps)

data_url <- "https://raw.githubusercontent.com/shususkeioku/ddataPage/main/adg.csv"
download.file(data_url, "data.csv")
readLines(url(data_url))
data <- read.csv(data_url)

# UI
ui <- fluidPage(
  titlePanel("Diplomatic Ties Visualized"),
  sidebarLayout(
    sidebarPanel(
      sliderInput("year", "Select Year", 
                  min = min(data$year), 
                  max = max(data$year), 
                  value = min(data$year),
                  step = 1),
      checkboxGroupInput(
        "dm", "Mission Rank",
        c("Ambassador" = 1, "Minister" = 2, "Charge d'Affaires" = 3, "Consul" = 4, "Other" = 5),
        c(1, 2, 3, 4, 5)
      ),
      selectInput("sen", "Sender:",
        append(data$ccodes, "ALL"), "ALL"
      ),
      selectInput("rec", "Receiver:",
        append(data$ccoder, "ALL"), "ALL"
      ),
    ),
    mainPanel(
      plotOutput("world_map")
    )
  )
)

# Server
server <- function(input, output) {
  output$world_map <- renderPlot({
    if (input$sen == "ALL" & input$rec == "ALL") {
      filtered_data <- data %>%
        filter(year == input$year, dm %in% input$dm)
    } else if (input$sen == "ALL") {
      filtered_data <- data %>%
        filter(year == input$year, dm %in% input$dm, ccoder == input$rec)
    } else if (input$rec == "ALL") {
      filtered_data <- data %>%
        filter(year == input$year, dm %in% input$dm, ccodes == input$sen)
    } else {
      filtered_data <- data %>%
        filter(year == input$year, dm %in% input$dm, ccodes == input$sen, ccoder == input$rec) 
    }
    
    world <- map_data("world")
    
    ggplot() +
      geom_polygon(data = world, aes(x = long, y = lat, group = group), fill = "lightgray", color = "white") +
      geom_curve(data = filtered_data, aes(x = lon180.x, y = lat.x, xend = lon180.y, yend = lat.y, color = dm),
                 curvature = 0.2, size = 0.5, alpha = 0.5) +
      coord_fixed() +
      theme_minimal() +
      theme(axis.text = element_blank(),
            axis.title = element_blank(),
            panel.grid = element_blank())
  })
}

# Run the application 
shinyApp(ui = ui, server = server)
```
